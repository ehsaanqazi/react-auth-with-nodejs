(this["webpackJsonpreact-auth-with-nodejs"]=this["webpackJsonpreact-auth-with-nodejs"]||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(16),s=n.n(a),o=n(3),i=n.n(o),l=n(5),u=n(9),d=n(2),j=n(4),m=n(8),p=n.n(m),b=n(0),f=r.a.createContext(),h="http://localhost:3000/api";function O(){return Object(c.useContext)(f)}function x(e){var t=e.children,n=Object(c.useState)(),r=Object(j.a)(n,2),a=r[0],s=r[1],o=Object(c.useState)(!0),i=Object(j.a)(o,2),l=i[0],u=i[1];Object(c.useEffect)((function(){!function(e){if(localStorage.token)return fetch("".concat(h,"/isLoggedIn"),{method:"POST",headers:new Headers({"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token"))}),body:JSON.stringify({token:e}),credentials:"include",mode:"cors"}).then((function(e){return e.json()})).then((function(t){t.token===e?(localStorage.setItem("token",t.token),s(t.token),u(!1)):(localStorage.clear(),s(null),Object(d.a)("/login"),u(!1))}));localStorage.clear(),s(null),Object(d.a)("/login"),u(!1)}(localStorage.token)}),[]);var m={login:function(e,t){return fetch("".concat(h,"/login"),{method:"POST",headers:new Headers({"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token"))}),body:JSON.stringify({email:e,password:t}),credentials:"include",mode:"cors"}).then((function(e){return e.json()})).then((function(e){return e.message?{message:e.message}:e.token?(s(e.token),{token:e.token}):{error:"An error occured"}})).catch((function(e){return e.message}))},register:function(e,t,n){return fetch("".concat(h,"/register"),{method:"POST",headers:{"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token"))},body:JSON.stringify({username:e,email:t,password:n}),credentials:"include",mode:"cors"})},signout:function(){localStorage.clear(),s(null)},updateUsername:function(e){return fetch("".concat(h,"/change-username"),{method:"POST",headers:{"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token")),Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({username:e}),credentials:"include",mode:"cors"})},updateEmail:function(e){return fetch("".concat(h,"/change-email"),{method:"POST",headers:{"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token")),Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({email:e}),credentials:"include",mode:"cors"})},updatePassword:function(e){return fetch("".concat(h,"/change-password"),{method:"POST",headers:{"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token")),Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({password:e}),credentials:"include",mode:"cors"})},forgotPassword:function(e){return fetch("".concat(h,"/forgot-password"),{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token"))},body:JSON.stringify({email:e}),credentials:"include",mode:"cors"})},currentUser:a,updateProfilePicture:function(e){return fetch("".concat(h,"/update-profilepicture"),{method:"POST",headers:new Headers({"csrf-token":"".concat(p.a.load("csrf-token")),Authorization:"Bearer "+localStorage.getItem("token")}),body:e,credentials:"include",mode:"cors"})},profile:function(){return fetch("".concat(h,"/profile"),{method:"GET",headers:{"Content-Type":"application/json","csrf-token":"".concat(p.a.load("csrf-token")),Authorization:"Bearer "+localStorage.getItem("token")},credentials:"include",mode:"cors"})}};return Object(b.jsx)(f.Provider,{value:m,children:!l&&t})}var g=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useState)(),r=Object(j.a)(n,2),a=r[0],s=r[1],o=Object(c.useState)(!1),m=Object(j.a)(o,2),f=m[0],h=m[1],x=O().login,g=Object(d.g)(),v=p.a.load("csrf-token");function w(){return(w=Object(l.a)(i.a.mark((function n(c){var r;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c.preventDefault(),n.prev=1,s(""),h(!0),n.next=6,x(e.current.value,t.current.value);case 6:(r=n.sent).token?(localStorage.setItem("token",r.token),g.push("/")):r.message?s(r.message):s("Something went wrong..."),h(!1),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(1),s("Something went wrong..."),h(!1);case 15:case"end":return n.stop()}}),n,null,[[1,11]])})))).apply(this,arguments)}return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)("div",{className:"login",children:Object(b.jsx)("div",{className:"login-content",children:Object(b.jsxs)("form",{onSubmit:function(e){return w.apply(this,arguments)},children:[Object(b.jsx)("h1",{className:"text-center my-4",children:"Login"}),Object(b.jsxs)("div",{className:"",children:[a?Object(b.jsx)("div",{className:"alert alert-danger",children:a}):"",Object(b.jsx)("input",{type:"hidden",name:"_csrf",value:v}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"email",placeholder:"Email address",ref:e,required:!0})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control",type:"password",placeholder:"Password",ref:t,required:!0})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("button",{disabled:f,className:"btn btn-primary btn-lg d-block w-100 fw-500 mb-3",children:"Login"})}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("span",{className:"text-center",children:"Not have an account? "}),Object(b.jsxs)(u.b,{to:"/register",className:"text-center text-muted",children:[" ","Register Here"]})]}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)(u.b,{to:"/forgot-password",children:" Forget Password"})})]})]})})})})};var v=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useRef)(),r=Object(c.useRef)(),a=Object(c.useState)(),s=Object(j.a)(a,2),o=s[0],d=s[1],m=Object(c.useState)(),p=Object(j.a)(m,2),f=p[0],h=p[1],x=Object(c.useState)(!1),g=Object(j.a)(x,2),v=g[0],w=g[1],y=O().register;function N(){return(N=Object(l.a)(i.a.mark((function c(a){return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(a.preventDefault(),n.current.value!==r.current.value){c.next=16;break}return c.prev=2,w(!0),c.next=6,y(e.current.value,t.current.value,n.current.value).then((function(e){return e.json()})).then((function(e){d(e.message),"Registered Sucessfully"===e.message?h("success"):h("danger")}));case 6:w(!1),c.next=14;break;case 9:c.prev=9,c.t0=c.catch(2),h("danger"),d("Something went wrong..."),w(!1);case 14:c.next=19;break;case 16:h("danger"),d("Password's don't match"),w(!1);case 19:case"end":return c.stop()}}),c,null,[[2,9]])})))).apply(this,arguments)}return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)("div",{className:"login",children:Object(b.jsxs)("div",{className:"login-content",children:[Object(b.jsxs)("form",{onSubmit:function(e){return N.apply(this,arguments)},children:[Object(b.jsx)("h1",{className:"text-center my-4",children:"Register"}),Object(b.jsxs)("div",{className:"justify-content-center",children:[o?Object(b.jsx)("div",{className:"alert alert-".concat(f),children:o}):"",Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"text",placeholder:"Username",ref:e,required:!0,minLength:"8"})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"text",placeholder:"Email address",ref:t,required:!0})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"password",placeholder:"Password",ref:n,required:!0,minLength:"8"})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"password",placeholder:"Confirm password",ref:r,required:!0,minLength:"8"})}),Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("button",{disabled:v,className:"btn btn-primary btn-lg d-block w-100 fw-500 mb-3",children:"Register"})})]})]}),Object(b.jsx)("span",{children:"Already have an account? "}),Object(b.jsx)(u.b,{to:"/login",children:" Login"})]})})})};var w=function(){var e=O(),t=e.signout,n=e.profile,r=Object(c.useState)(),a=Object(j.a)(r,2),s=a[0],o=a[1],d=Object(c.useState)([]),m=Object(j.a)(d,2),p=m[0],f=m[1];function h(){return(h=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),o("Something went wrong...");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function x(){return(x=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n().then((function(e){return e.json()})).then((function(e){return f(e)}));case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}return Object(c.useEffect)((function(){!function(){x.apply(this,arguments)}()})),Object(b.jsx)(b.Fragment,{children:Object(b.jsx)("div",{className:"container mt-4 mb-4 p-3 d-flex justify-content-center",children:Object(b.jsxs)("div",{className:"card p-4",children:[Object(b.jsxs)("h3",{children:["Username : ",p.username]}),Object(b.jsxs)("h3",{children:["Email : ",p.email]}),Object(b.jsxs)("div",{className:" image d-flex flex-column justify-content-center align-items-center",children:[s?Object(b.jsx)("div",{className:"alert alert-danger",children:s}):"",Object(b.jsx)("img",{src:"".concat("http://localhost:3000","/uploads/")+p.profilePicture,height:"100",width:"100",alt:"user"}),Object(b.jsx)("div",{className:" d-flex mt-2",children:Object(b.jsx)(u.b,{to:"/update-profile",children:"Edit Profile"})}),Object(b.jsx)("button",{onClick:function(){return h.apply(this,arguments)},className:"btn btn-danger",children:"Log Out"})]})]})})})};var y=function(){var e=Object(c.useRef)(),t=Object(c.useState)(),n=Object(j.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(!1),o=Object(j.a)(s,2),d=o[0],m=o[1],p=Object(c.useState)(),f=Object(j.a)(p,2),h=f[0],x=f[1],g=O().forgotPassword;function v(){return(v=Object(l.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,a(""),m(!0),t.next=6,g(e.current.value).then((function(e){return e.json()})).then((function(e){a(e.message),"Check your email for password link.."===e.message?x("success"):x("danger")}));case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),a("Something went wrong");case 11:m(!1);case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}return Object(b.jsxs)(b.Fragment,{children:[" ",Object(b.jsx)("div",{className:"login",children:Object(b.jsx)("div",{className:"login-content",children:Object(b.jsxs)("form",{onSubmit:function(e){return v.apply(this,arguments)},children:[Object(b.jsx)("h1",{className:"text-center my-4",children:"Enter your email"}),Object(b.jsxs)("div",{children:[r?Object(b.jsx)("div",{className:"alert alert-".concat(h),children:r}):"",Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("input",{className:"form-control form-control-lg fs-15px",type:"email",placeholder:"Email address",ref:e,required:!0})}),Object(b.jsx)("div",{className:"md-3",children:Object(b.jsx)("button",{disabled:d,className:"btn btn-primary btn-lg d-block w-100 fw-500 mb-3",children:"Reset"})}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("span",{className:"text-center",children:"Let's Login "}),Object(b.jsx)(u.b,{to:"/login",className:"text-center text-muted",children:"Login"})]})]})]})})})]})};var N=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useRef)(),r=Object(c.useState)(),a=Object(j.a)(r,2),s=a[0],o=a[1],u=Object(c.useState)(),d=Object(j.a)(u,2),m=d[0],p=d[1],f=Object(c.useState)(),h=Object(j.a)(f,2),x=h[0],g=h[1],v=Object(c.useState)(!1),w=Object(j.a)(v,2),y=w[0],N=w[1],S=O(),k=S.updateUsername,P=S.updateEmail,T=S.updatePassword,C=S.updateProfilePicture;function E(){return(E=Object(l.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,N(!0),e.next=5,k(t.current.value).then((function(e){return e.json()})).then((function(e){p(e.message),"Updated Sucessfully"===e.message?g("success"):g("danger")})).catch((function(e){p("Something went wrong...")}));case 5:N(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),N(!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function R(){return(R=Object(l.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,N(!0),t.next=5,P(e.current.value).then((function(e){return e.json()})).then((function(e){p(e.message),"Updated Sucessfully"===e.message?g("success"):g("danger")})).catch((function(e){p("Something went wrong")}));case 5:N(!1),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),p("Something went wrong..."),N(!1);case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}function U(){return(U=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,N(!0),e.next=5,T(n.current.value).then((function(e){return e.json()})).then((function(e){p(e.message),"Updated Sucessfully"===e.message?g("success"):g("danger")})).catch((function(e){p("Something went wrong")}));case 5:N(!1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),p("Something went wrong"),N(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function L(){return(L=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,(n=new FormData).append("profilePicture",s),N(!0),e.next=7,C(n).then((function(e){return e.json()})).then((function(e){p(e.message),"Updated Sucessfully"===e.message?g("success"):g("danger")})).catch((function(e){p("Something went wrong")}));case 7:N(!1),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),p("Something went wrong"),N(!1);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)("div",{className:"login",children:Object(b.jsxs)("div",{className:"login-content",children:[Object(b.jsxs)("form",{onSubmit:function(e){return L.apply(this,arguments)},children:[Object(b.jsx)("h1",{className:"text-center my-4",children:"Change Details"}),m?Object(b.jsx)("div",{className:"alert alert-".concat(x),children:m}):"",Object(b.jsxs)("div",{className:"mb-3 d-flex",children:[Object(b.jsx)("input",{className:"p-2 m-2 form-control form-control fs-15px",type:"file",placeholder:"Profile Picture",name:"profilePicture",required:!0,onChange:function(e){o(e.target.files[0])}}),Object(b.jsx)("button",{disabled:y,className:"p-2 m-2  btn btn-primary",children:"Update"})]})]}),Object(b.jsx)("form",{onSubmit:function(e){return E.apply(this,arguments)},children:Object(b.jsxs)("div",{className:"mb-3 d-flex",children:[Object(b.jsx)("input",{className:"p-2  m-2  form-control form-control fs-15px",type:"text",placeholder:"Username",ref:t,required:!0,minLength:"8"}),Object(b.jsx)("button",{disabled:y,className:"p-2 m-2  btn btn-primary",children:"Update"})]})}),Object(b.jsx)("form",{onSubmit:function(e){return R.apply(this,arguments)},children:Object(b.jsxs)("div",{className:"mb-3 d-flex",children:[Object(b.jsx)("input",{className:"p-2 m-2   form-control form-control fs-15px",type:"email",placeholder:"Email address",ref:e,required:!0}),Object(b.jsx)("button",{disabled:y,className:"p-2 m-2  btn btn-primary",children:"Update"})]})}),Object(b.jsx)("form",{onSubmit:function(e){return U.apply(this,arguments)},children:Object(b.jsxs)("div",{className:"mb-3 d-flex",children:[Object(b.jsx)("input",{className:"p-2  m-2  form-control form-control fs-15px",type:"password",placeholder:"Password",ref:n,minLength:"8"}),Object(b.jsx)("button",{disabled:y,className:"p-2 m-2  btn btn-primary",children:"Update"})]})})]})})})},S=n(12),k=n(19),P=["component"];var T=function(e){var t=e.component,n=Object(k.a)(e,P),c=O().currentUser;return Object(b.jsx)(d.b,Object(S.a)(Object(S.a)({},n),{},{render:function(e){return c?Object(b.jsx)(t,Object(S.a)({},e)):Object(b.jsx)(d.a,{to:"/login"})}}))};var C=function(){var e="http://localhost:3000/api";function t(){return(t=Object(l.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(e),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",mode:"cors"});case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(c.useEffect)((function(){!function(){t.apply(this,arguments)}()})),Object(b.jsx)(u.a,{children:Object(b.jsx)(x,{children:Object(b.jsxs)(d.d,{children:[Object(b.jsx)(T,{exact:!0,path:"/",component:w}),Object(b.jsx)(d.b,{path:"/register",component:v}),Object(b.jsx)(T,{path:"/dashboard",component:w}),Object(b.jsx)(d.b,{path:"/login",component:g}),Object(b.jsx)(d.b,{path:"/forgot-password",component:y}),Object(b.jsx)(T,{path:"/update-profile",component:N})]})})})};n(36);s.a.render(Object(b.jsx)(r.a.StrictMode,{children:Object(b.jsx)(C,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.c9fe73a3.chunk.js.map